<!DOCTYPE html>
<html>

<head>
    {%metas%}
    <title>{%title%}</title>
    {%favicon%}
    {%css%}
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.0/full/pyodide.js"></script>
</head>

<body>
    <!-- <div id="pyodide_status" class="lds-ring">
        <p></p>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div> -->
    <script>
        function set_status_msg(msg) {
            let msg_status = document.getElementById('pyodide_status').getElementsByTagName('p')[0];
            msg_status.innerText = msg;
        }

        function remove_status_div() {
            const status_div = document.getElementById('pyodide_status');
            status_div.remove();
        }

        function add_status_div() {
            let status_div = document.createElement('div');
            status_div.setAttribute('id', 'pyodide_status');
            status_div.setAttribute('class', 'lds-ring');

            status_div.append(document.createElement('p'));
            for (let i = 0; i < 4; i++) {
                status_div.append(document.createElement('div'));
            }

            document.body.append(status_div);
        }

        async function initPyodide() {
            add_status_div();
            set_status_msg('Loading pyodide');
            let pyodide = await loadPyodide();

            set_status_msg('Loading packages')
            await pyodide.loadPackage(["pandas"]);
            window.pyodide = pyodide;

            set_status_msg('Importing packages')
            await pyodide.runPython('import pandas as pd')
            window.pyodide_ready = true;
            set_status_msg('All done')
            remove_status_div();
        }
        initPyodide();
    </script>
    <!--[if IE]>
        <script>
            alert("Dash v2.7+ does not support Internet Explorer. Please use a newer browser.");
        </script>
    <![endif]-->
    {%app_entry%}
    <footer>
        {%config%}
        {%scripts%}
        {%renderer%}
    </footer>
</body>

</html>